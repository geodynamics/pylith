[pylithapp]

# ----------------------------------------------------------------------
# PROBLEM DESCRIPTION
# ----------------------------------------------------------------------

#
# This file is for a simulation with the following characteristics:
#   1.  The material is Drucker-Prager elastoplastic with a friction angle
#       of 10 deg, a cohesion of 50 Pa, and a dilatation angle of 0 deg.
#   2.  There is no gravity.
#   3.  There are no initial stresses.
#   4.  Velocity BC are applied at a rate of 0.03 mm/yr for 10 years.
#   5.  The nonlinear solver is used.
#
# ----------------------------------------------------------------------
# RUNNING THE SIMULATON
# ----------------------------------------------------------------------

# This is not a self-contained simulation configuration file. This
# file only specifies parameters specific to this problem.
# The general parameters are specificed in the pylithapp.cfg
# file which PyLith reads by default.
#
# To run the simulation:
# pylith plas_dp3_ng_ni_v03.cfg
#
# Output will be directed to the directory ../results.

# ----------------------------------------------------------------------
# problem
# ----------------------------------------------------------------------
[pylithapp.timedependent]
# For this problem we must switch to a nonlinear solver.
formulation.solver = pylith.problems.SolverNonlinear

# Set bc to an array of 5 boundary conditions: 'x_pos','x_neg', 'y_neg',
# 'z_pos', and 'z_neg'.
bc = [x_pos,x_neg,y_neg,z_pos,z_neg]

[pylithapp.timedependent.formulation]
# Set the output to an array of 1 output manager.
# We will output the solution over the domain.
output = [domain]

# Change the total simulation time to 10 years, and set the time
# step size to 1 years.
[pylithapp.timedependent.formulation.time_step]
total_time = 10.0*year
dt = 1.0*year

# ----------------------------------------------------------------------
# materials
# ----------------------------------------------------------------------
[pylithapp.timedependent]
materials = [plastic_material]
materials.plastic_material = pylith.materials.DruckerPrager3D

[pylithapp.timedependent.materials.plastic_material]
label = Plastic material
id = 1
db_properties.iohandler.filename = ../spatialdb/mat_plastic_dp3.spatialdb
quadrature.cell = pylith.feassemble.FIATLagrange
quadrature.cell.dimension = 3
output.cell_info_fields = [density,mu,lambda,alpha_yield,beta,alpha_flow]
output.cell_data_fields = [total_strain,stress,plastic_strain]

# ----------------------------------------------------------------------
# boundary conditions
# ----------------------------------------------------------------------
# The label corresponds to the name of the nodeset in CUBIT.

# +x face
[pylithapp.timedependent.bc.x_pos]
bc_dof = [0]
label = face_xpos
db_rate = spatialdata.spatialdb.UniformDB
db_rate.label = Dirichlet rate BC on +x
db_rate.values = [displacement-rate-x,rate-start-time]
db_rate.data = [-0.03*mm/year,0.0*year]

# -x face
[pylithapp.timedependent.bc.x_neg]
bc_dof = [0]
label = face_xneg
db_initial.label = Dirichlet BC on -x

# -z face
[pylithapp.timedependent.bc.z_neg]
bc_dof = [2]
label = face_zneg
db_initial.label = Dirichlet BC on -z

# +z face
[pylithapp.timedependent.bc.z_pos]
bc_dof = [2]
label = face_zpos
db_initial.label = Dirichlet BC on +z

# -y face
[pylithapp.timedependent.bc.y_neg]
bc_dof = [0, 1]
label = face_yneg
db_rate = spatialdata.spatialdb.SimpleDB
db_rate.label = Dirichlet rate BC on -y
db_rate.iohandler.filename = ../spatialdb/basal_rate_bc_03.spatialdb

# ----------------------------------------------------------------------
# output
# ----------------------------------------------------------------------
# Give basename for VTK domain output of solution over domain.
[pylithapp.problem.formulation.output.domain]
skip = 0
writer.filename = ../results/plas_dp3_ng_ni_v03.vtk
writer.time_format = %04.0f
writer.time_constant = 1.0*year

# Give basename for VTK output of state variables.
[pylithapp.timedependent.materials.plastic_material.output]
# Average values over quadrature points.
cell_filter = pylith.meshio.CellFilterAvgMesh
skip = 0
writer.filename = ../results/plas_dp3_ng_ni_v03-plastic_material.vtk
writer.time_format = %04.0f
writer.time_constant = 1.0*year
