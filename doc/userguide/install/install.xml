<?xml version="1.0"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
  "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<chapter id="install">
  <title>Installation and Getting Help</title>

  <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <section>
    <title>Introduction</title>
    <para>
      Installation of PyLith on a desktop or laptop machine is, in
      most cases, very easy. Binary packages have been created for the
      most common platforms, including Linux, OSX, and
      Windows. Installation on machines that are not compatible with
      any of these operating systems requires building the software
      from the source code, which can be difficult for inexperienced
      users.
    </para>
  </section>

  <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <section>
    <title>Getting Help</title>

    <para>
      Help is available via the CIG Short-Term Crustal Dynamics
      Mailing List and CIG's issue tracking system.
    </para>

    <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <section>
      <title>Requesting help</title>

      <para>
        The CIG Short-Term Crustal Dynamics Mailing List,
        <email>cig-short@geodynamics.org</email>, is a mailing list
        dedicated to CIG issues associated with short-term crustal
        dynamics, including the use of PyLith. You can subscribe to
        the mailing list and view messages at the <ulink
        url="http://www.geodynamics.org">CIG website</ulink>.
      </para>
    </section>

    <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <section>
      <title>Reporting bugs and errors</title>

      <para>
        CIG uses the <application>Roundup</application> for bug
        tracking. If you find a bug in PyLith, please submit a bug
        report to the <ulink
        url="http://www.geodynamics.org/roundup">CIG
        <application>Roundup</application> system</ulink>. Of course,
        it is helpful to first check to see if someone else already
        submitted a report related to the issue; one of the CIG
        developers may have already posted a solution to the
        problem. You can reply to a current issue by clicking on the
        issue title. To submit a new issue, click on <guibutton>Create
        New</guibutton> under <guimenu>Issues</guimenu>.
      </para>
    </section>

  </section>

  <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <section>
    <title>Installation</title>
    <para>
      Binary executables are available for three of the most widely
      used platforms: 32-bit Linux, Mac OSX, and Windows. If your
      platform is not compatible with any of these, you can build the
      software from the source code.
    </para>

    <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <section>
      <title>Linux</title>

      <para>
        Running the Linux binary version of PyLith requires a 32-bit
        compatible machine with GLIBC 2.2 or later.
      </para>

      <orderedlist>
	<listitem>
	  <para>
            Download the <ulink
            url="http://crust.geodynamics.org/~leif/shipping/">tarball</ulink>.
          </para>
	</listitem>
	<listitem>
	  <para>
            Unpack the tarball in a suitable
            location.
          </para>
          <screen>
<prompt>bash$ </prompt><userinput>tar -zxvf pylith-0.8-linux-x86.tar.gz</userinput>
          </screen>
	</listitem>
	<listitem>
	  <para>
            Add <filename
            class="directory">pylith-0.8-linux-x86/bin</filename> to
            your <envar>PATH</envar>. You will likely want to add
            something like
	  <screen>
PATH=${PATH}:<replaceable>replace_with_absolute_path</replaceable>/pylith-0.8-linux-x86/bin
          </screen>
            to your <filename>.bashrc</filename> file (if you are
            using bash as your shell) or the equivalent to your
            <filename>.cshrc</filename> file (if you are using tcsh as
            your shell).
          </para>
	</listitem>
	<listitem>
	  <para>
            Add <filename
            class="directory">pylith-0.8-linux-x86/lib</filename> to
            your <envar>LD_LIBRARY_PATH</envar>. You will likely want to add
            something like
	  <screen>
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:<replaceable>replace_with_</replaceable>
<replaceable>absolute_path</replaceable>/pylith-0.8-linux-x86/lib
          </screen>
            to your <filename>.bashrc</filename> file (if you are
            using bash as your shell) or the equivalent to your
            <filename>.cshrc</filename> file (if you are using tcsh as
            your shell).
          </para>
	</listitem>
	<listitem>
	  <para>
            To uninstall PyLith, simply remove the <filename
            classname="directory">pylith-0.8-linux-x86</filename>
            directory and all of its sub-directories.
          </para>
	</listitem>
      </orderedlist>

    </section>

    <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <section>
      <title>Mac OSX</title>

      <para>
        The OSX binary version was built to run on the Macintosh
        PowerPC architecture with OSX version 10.2 or later. The
        binary will run on the Macintosh Intel architecture, but only
        in emulation mode (i.e., rather slowly).
      </para>

      <orderedlist>
	<listitem>
	  <para>
            Download the <ulink
            url="http://crust.geodynamics.org/~leif/shipping/">disk image</ulink>.
          </para>
	</listitem>
	<listitem>
	  <para>
            Double click on the disk image to mount the disk.
          </para>
	</listitem>
	<listitem>
	  <para>
            Double click on the disk and copy the <filename
            classname="directory">PyLith</filename> folder to a
            suiteable location.
          </para>
	</listitem>
	<listitem>
	  <para>
            To run PyLith, double click on the PyLith icon provided in the
            <filename classname="directory">PyLith</filename> folder.
          </para>
	</listitem>
	<listitem>
	  <para>
            To uninstall PyLith, simply drag the <filename
            classname="directory">PyLith</filename> folder to the
            trash.
          </para>
	</listitem>
      </orderedlist>

    </section>


    <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <section>
      <title>Windows</title>

      <para>
        This Windows binary version of PyLith should be compatible
        with Windows NT, Windows 2000, and Windows XP.
      </para>

      <orderedlist>
	<listitem>
	  <para>
            Download the <ulink
            url="http://crust.geodynamics.org/~leif/shipping/">installer</ulink>.
          </para>
	</listitem>
	<listitem>
	  <para>
            Double click on the <filename>setup.exe</filename> file
            you just downloaded and follow the instructions for
            installing.
          </para>
	</listitem>
	<listitem>
	  <para>
            To run PyLith, double click on the PyLith icon on the
            desktop or select
            <menuchoice><guimenu>Start</guimenu><guimenuitem>All
            Programs</guimenuitem><guimenuitem>PyLith</guimenuitem><guimenuitem>PyLith</guimenuitem>
            </menuchoice>
          </para>
	</listitem>
	<listitem>
	  <para>
            To uninstall PyLith, simply select
            <menuchoice><guimenu>Start</guimenu><guimenuitem>All
            Programs</guimenuitem><guimenuitem>PyLith</guimenuitem><guimenuitem>Uninstall
            PyLith</guimenuitem> </menuchoice>.
          </para>
	</listitem>
      </orderedlist>
    </section>

    <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <section>
      <title>Building using source tarball</title>

      <para>
        Building PyLith from the source code is not a trivial task
        because PyLith depends on several other packages. In general,
        each package must be compiled from source using compilers for
        each language that are compatible with one another. The stable
        version of the PyLith source code is available from the <ulink
        url="http://www.geodynamics.org:8080/cig/software/Repository/">Geodynamics
        subversion repository</ulink> under <filename
        classname="directory">cig/short/3D/PyLith/branches/pylith-0.8</filename>.
      </para>

      <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++ -->
      <section>
	<title>System Requirements</title>

	<itemizedlist>
	  <listitem>
	    <para>Unix flavored operating system</para>
	  </listitem>
	  <listitem>
	    <para>Fortran, C, and C++ compilers</para>
	  </listitem>
	  <listitem>
	    <para>Python (2.3 or later)</para>
	  </listitem>
	</itemizedlist>
      </section>

      <para>
        The software must be built starting from the bottom of the
        dependency list and working upwards. The steps below describe
        the recommended way to build PyLith and the external packages
        on which it depends. Some of the dependencies can be satisfied
        using precompiled binaries (e.g., RedHat and Fink
        packages). When considering whether to use a precompiled
        binary package to satisfy any of the dependencies, remember
        that all of the compilers and settings used in building the
        code must be compatible.
      </para>

      <orderedlist>
	<listitem>
	  <para>
            Build PETSc and MPI.
          </para>
	  <orderedlist numeration="lowerroman">
	    <listitem>
	      <para>
                ADD STUFF HERE
              </para>
	    </listitem>
	  </orderedlist>
	</listitem>
	<listitem>
	  <para>
            Build Pythia.
          </para>
	  <orderedlist numeration="lowerroman">
	    <listitem>
	      <para>
                ADD STUFF HERE
              </para>
	    </listitem>
	  </orderedlist>
	</listitem>
	<listitem>
	  <para>
            Build PyLith.
          </para>
	  <orderedlist numeration="lowerroman">
	    <listitem>
	      <para>
                ADD STUFF HERE
              </para>
	    </listitem>
	  </orderedlist>
	</listitem>
      </orderedlist>

    </section>

    <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <section>
      <title>Building using source repositories</title>

      <warning>
	<para>
          Building PyLith using the source repositories is recommended
          only for expert users who are willing to work with a moving
          target and rebuild on a frequent basis. The installation
          instructions cover the basic steps and assume the user has
          experience building and installing software.
        </para>
      </warning>

      <para>
        The PyLith-0.8 source code is available from the <ulink
        url="http://www.geodynamics.org:8080/cig/software/Repository/">Geodynamics
        subversion repository</ulink> under <filename
        classname="directory">cig/short/3D/PyLith/branches/pylith-0.8</filename>.
      </para>

      <!-- SECTION +++++++++++++++++++++++++++++++++++++++++++++++ -->
      <section>
	<title>System Requirements</title>

	<itemizedlist>
	  <listitem>
	    <para>Unix flavored operating system</para>
	  </listitem>
	  <listitem>
	    <para>Fortran, C, and C++ compilers</para>
	  </listitem>
	  <listitem>
	    <para>Python (2.3 or later)</para>
	  </listitem>
	  <listitem>
	    <para>Subversion</para>
	  </listitem>
	  <listitem>
	    <para>Mercurial (0.9 or later)</para>
	  </listitem>
	</itemizedlist>

	<tip>
	  <para>
            Many flavors of Unix have Subversion packages. In most
            cases you do not need anything but the basic subversion
            package. You will likely have to build Mercurial from
            source, but this is a very easy task that takes only a
            couple of minutes.
          </para>
	</tip>

      </section>

      <para>
        The software must be built starting from the bottom of the
        dependency list and working upwards. The steps below describe
        the recommended way to build PyLith and the external packages
        on which it depends.
      </para>

      <orderedlist>
	<listitem>
	  <para>
            Build <ulink
            url="http://www-unix.mcs.anl.gov/petsc/petsc-as/developers/index.html">PETSc (developers version)</ulink>
            and MPI.
          </para>
	  <para>
            If you have an architecture optimized version of
            BLAS/LAPACK you should use those instead of asking PETSc
            to download and build one for you. In some cases, PETSc
            will find known optimized implementations of BLAS/LAPACK
            (e.g., vecLib on Mac OSX).
          </para>
	  <para>
            If you have an MPI implementation installed, you can use
            it or let PETSc download and install one for you.
          </para>
	  <tip>
	    <para>
              If you run into problems configuring or building PETSc,
              send <emphasis>both</emphasis>
              <filename>configure.log</filename> and
              <filename>make_<replaceable>PETSC_ARCH</replaceable></filename>
              to <email>petsc-maint@mcs.anl.gov</email>.
            </para>
	  </tip>
	  <orderedlist numeration="lowerroman">
	    <listitem>
	      <para>
                Pull the source code from ANL and place the source
                tree in a suitable location. The steps below will
                create a <filename
                class="directory">petsc-dev</filename> sub-directory
                in the current directory.
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>hg clone http://mercurial.mcs.anl.gov/petsc/petsc-dev</userinput>
<prompt>bash$ </prompt><userinput>cd petsc-dev/python</userinput>
<prompt>bash$ </prompt><userinput>hg clone http://mercurial.mcs.anl.gov/petsc/BuildSystem \
BuildSystem</userinput>
              </screen>
	    </listitem>
	    <listitem>
	      <para>
                Set the <envar>PETSC_DIR</envar> and
                <envar>PETSC_ARCH</envar> environment
                variables. <envar>PETSC_DIR</envar> corresponds to
                the top-level directory in the PETSc source tree and
                <envar>PETSC_ARCH</envar> is a tag for this
                configuration of PETSc (e.g., linux_gcc-4.0_debug,
                darwin_gcc-3.4_opt, etc). You will want to set these
                environment variables in your
                <filename>.bashrc</filename>,
                <filename>.cshrc</filename>, or similar file.
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>export PETSC_DIR=<replaceable>replace_with_absolute_path</replaceable>/petsc-dev</userinput>
<prompt>bash$ </prompt><userinput>export PETSC_ARCH=<replaceable>replace_with_PETSc_arch_tag</replaceable></userinput>
              </screen>
	    </listitem>
	    <listitem>
	      <para>
                Configure PETSc.
              </para>
	      <para>
                Run <command>config/configure.py</command> with the
                appropriate arguments to configure PETSc for your
                computer. Run <command>config/configure.py
                --help</command> to see the long list of possible
                options. Building PETSc for use with PyLith requires
                the following arguments:
              </para>
	      <screen>
<option>--with-clanguage=c++</option>
<option>--with-c-support</option>
<option>--with-shared=1</option>
<option>--with-boost=1</option>
<option>--download-boost=1</option>
<option>--with-sieve=1</option>
              </screen>
	      <para>
                Be sure to include flags indicating where MPI and
                BLAS/LAPACK are if you want to use a preinstalled
                implementation. If not, be sure to tell PETSc to
                download those packages. If you do not want build
                PETSc using the gnu compilers, be sure to let PETSc
                know which compilers you want to use instead.
              </para>
	      <para>
                After several minutes, the configure script should
                finish and display the PETSc settings. Check to make
                sure these match your expectations before continuing.
              </para>
	    </listitem>
	    <listitem>
	      <para>
                Build PETSc.
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>make</userinput>
              </screen>
	    </listitem>
	    <listitem>
	      <para>
                Test PETSc installation.
              </para>
	      <para>
                One of the tests will attempt to display some X
                windows. If X windows is not available from the shell
                in which you run <command>make test</command>, then
                that test will fail.
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>make test</userinput>
              </screen>
	    </listitem>
	    <listitem>
	      <para>
                In the future, you will likely want to update the
                PETSc source tree to include bug fixes, new features
                etc.
              </para>
              <para>
                To update PETSc (use to <command>hg update
                -v</command> to see what files are being updated):
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>cd petsc-dev</userinput>
<prompt>bash$ </prompt><userinput>hg pull</userinput>
<prompt>bash$ </prompt><userinput>hg update</userinput>
<prompt>bash$ </prompt><userinput>cd python/BuildSystem</userinput>
<prompt>bash$ </prompt><userinput>hg pull</userinput>
<prompt>bash$ </prompt><userinput>hg update</userinput>
              </screen>
	    </listitem>
	  </orderedlist>
	</listitem>
	<listitem>
	  <para>
            Build Pythia.
          </para>
	  <tip>
	    <para>
              If you run into problems configuring or building Pythia,
              send <emphasis>both</emphasis> the
              <filename>config.log</filename> and
              <filename>make.log</filename> files to
              <email>cig-short@geodynamics.org</email>. To create the
              <filename>make.log</filename> file, run make via
              <command>make &gt;&amp; make.log</command>.
            </para>
	  </tip>
	  <orderedlist numeration="lowerroman">
	    <listitem>
	      <para>
                Pull the source code from CIG and place the source
                tree in a suitable location. The steps below will
                create a <filename
                class="directory">pythia-0.8</filename> sub-directory
                in the current directory.
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>svn co svn://geodynamics.org/cig/vendor/pythia [cont.]
/v0.8/pythia-0.8</userinput>
              </screen>
	    </listitem>
	    <listitem>
	      <para>
                Configure Pythia.
              </para>
	      <para>
                Run <command>configure</command> with the appropriate
                arguments. Run <command>configure --help</command> to
                see a list of possible options. You may want to
                specify compilers and/or an install location.
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>cd pythia-0.8</userinput>
<prompt>bash$ </prompt><userinput>autoreconf -i</userinput>
<prompt>bash$ </prompt><userinput>./configure</userinput>
              </screen>
	    </listitem>
	    <listitem>
	      <para>
                Build Pythia.
              </para>
	      <para>
                Run <command>make</command> and <command>make install</command>.
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>make</userinput>
<prompt>bash$ </prompt><userinput>make install</userinput>
              </screen>
	    </listitem>
	  </orderedlist>
	</listitem>
	<listitem>
	  <para>
            Build PyLith.
          </para>
	  <tip>
	    <para>
              If you run into problems configuring or building PyLith,
              send <emphasis>both</emphasis> the
              <filename>config.log</filename> and
              <filename>make.log</filename> files to
              <email>cig-short@geodynamics.org</email>. To create the
              <filename>make.log</filename> file, run make via
              <command>make &gt;&amp; make.log</command>.
            </para>
	  </tip>
	  <orderedlist numeration="lowerroman">
	    <listitem>
	      <para>
                Pull the source code from CIG and place the source
                tree in a suitable location. The steps below will
                create a <filename
                class="directory">pylith-0.8</filename> sub-directory
                in the current directory.
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>svn co svn://geodynamics.org/cig/short/3D/PyLith [cont.]
/branches/pylith-0.8</userinput>
              </screen>
	    </listitem>
	    <listitem>
	      <para>
                Configure PyLith.
              </para>
	      <para>
                Run <command>configure</command> with the appropriate
                arguments. Run <command>configure --help</command> to
                see a list of possible options. You may want to
                specify compilers and/or an install location. If you
                installed pythia-0.8 in a non-system location, you
                will need to set <envar>CPPFLAGS</envar> and
                <envar>LDFLAGS</envar> appropriately.
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>cd pylith-0.8</userinput>
<prompt>bash$ </prompt><userinput>autoreconf -i</userinput>
<prompt>bash$ </prompt><userinput>./configure</userinput>
              </screen>
	    </listitem>
	    <listitem>
	      <para>
                Build PyLith.
              </para>
	      <para>
                Run <command>make</command> and <command>make install</command>.
              </para>
	      <screen>
<prompt>bash$ </prompt><userinput>make</userinput>
<prompt>bash$ </prompt><userinput>make install</userinput>
              </screen>
	    </listitem>
	  </orderedlist>
	</listitem>
      </orderedlist>

    </section>

  </section>

</chapter>
